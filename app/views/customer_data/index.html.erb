<% title 'Kundendaten der ' + @cooperative.name %>

<p class="title is-2"><%= yield :title %></p>

<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>

<div class="tabs is-boxed">
  <ul>
  <li>
  <a href="<%= url_for controller: 'cooperatives', action: 'show', id: @cooperative.id %>">
    <span class="icon"><i class="fas fa-chevron-left"></i></span>
    <span>zurück</span>
  </a>
  </li>

  <% if @cooperative.customer_data_pdf.attached? %>
  <li>
  <a href="<%= rails_blob_path(@cooperative.customer_data_pdf, disposition: "attachment") %>">
    <span class="icon"><i class="fas fa-cloud-download-alt"></i></span>
    <span>PDF</span>
  </a>
  </li>
  <% end %>
  </ul>
</div>

<% if @cooperative.customer_data_pdf.attached? %>
<object data="<%= rails_blob_path(@cooperative.customer_data_pdf) %>" type="application/pdf" width="100%" height="500px">
  This browser does not support PDFs. Please download the PDF to view it: <a href="<%= rails_blob_path(@cooperative.customer_data_pdf) %>">Download PDF</a>
</object>
<% end %>

<% if @cooperative.customer_data_xls.attached? %>
<div id="customer-data-table-container" class="content">
</div>

<% content_for :head do %>
<script>
var url = "<%= rails_blob_path(@cooperative.customer_data_xls) %>";

/* set up async GET request */
var req = new XMLHttpRequest();
req.open("GET", url, true);
req.responseType = "arraybuffer";

req.onload = function(e) {
  var data = new Uint8Array(req.response);
  var workbook = XLSX.read(data, {type:"array"});

  var worksheet = workbook.Sheets[workbook.SheetNames[1]];
  var container = document.getElementById('customer-data-table-container');
  container.innerHTML = XLSX.utils.sheet_to_html(worksheet);
}

req.send();
</script>
<% end %>
<% end %>

<% if !@cooperative.customer_data_pdf.attached? and !@cooperative.customer_data_xls.attached? %>
<div class="notification is-danger">
Keine Kundendaten verfügbar.
</div>
<% end %>
